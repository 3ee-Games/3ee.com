var _t=Object.defineProperty;var at=Object.getOwnPropertySymbols;var ht=Object.prototype.hasOwnProperty,ut=Object.prototype.propertyIsEnumerable;var lt=(i,r,o)=>r in i?_t(i,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[r]=o,Ue=(i,r)=>{for(var o in r||(r={}))ht.call(r,o)&&lt(i,o,r[o]);if(at)for(var o of at(r))ut.call(r,o)&&lt(i,o,r[o]);return i};import{S as vt,i as dt,s as pt,e as a,t as c,k as M,c as l,a as s,h as _,d as t,m as A,b as d,g as Ce,G as e,j as st,a0 as ft,a2 as ot,N as nt,a3 as pe,H as ie,E as rt,O as mt,v as gt,a4 as it}from"../../../chunks/index-2a82a4a8.js";function ct(i){let r,o,n,g,k,U,h,f,O=i[4].formula+"",C,V,m,L=JSON.stringify(i[3],null,2)+"",u;return{c(){r=a("div"),o=a("div"),n=a("p"),g=a("strong"),k=c("Training Plan Calculation:"),U=M(),h=a("p"),f=a("span"),C=c(O),V=M(),m=a("pre"),u=c(L),this.h()},l(p){r=l(p,"DIV",{class:!0});var E=s(r);o=l(E,"DIV",{class:!0});var T=s(o);n=l(T,"P",{class:!0});var v=s(n);g=l(v,"STRONG",{});var N=s(g);k=_(N,"Training Plan Calculation:"),N.forEach(t),v.forEach(t),U=A(T),h=l(T,"P",{class:!0});var H=s(h);f=l(H,"SPAN",{class:!0});var R=s(f);C=_(R,O),R.forEach(t),H.forEach(t),T.forEach(t),V=A(E),m=l(E,"PRE",{class:!0});var j=s(m);u=_(j,L),j.forEach(t),E.forEach(t),this.h()},h(){d(n,"class","svelte-166haca"),d(f,"class","highlight large svelte-166haca"),d(h,"class","svelte-166haca"),d(o,"class","step-calculation svelte-166haca"),d(m,"class","svelte-166haca"),d(r,"class","results svelte-166haca")},m(p,E){Ce(p,r,E),e(r,o),e(o,n),e(n,g),e(g,k),e(o,U),e(o,h),e(h,f),e(f,C),e(r,V),e(r,m),e(m,u)},p(p,E){E&16&&O!==(O=p[4].formula+"")&&st(C,O),E&8&&L!==(L=JSON.stringify(p[3],null,2)+"")&&st(u,L)},d(p){p&&t(r)}}}function Et(i){let r,o,n,g,k,U,h,f,O,C,V,m,L,u,p,E,T,v,N,H,R,j,D,ae,P,q,I,le,z,J,K,W,Z,fe,me,y,$,ge,B,Ee,be,Se=Object.keys(i[4]).length>0,ce,ee,G,Q,Oe,se,Le,Ie,Te,X,Ne,oe,Pe,Me,Ae,ne,Re,ke,re,ze,ye,De,b=Se&&ct(i);return{c(){r=M(),o=a("section"),n=a("div"),g=a("h1"),k=c("LoRA Training Settings Generator"),U=M(),h=a("form"),f=a("div"),O=a("label"),C=c("Training Images:"),V=M(),m=a("input"),L=M(),u=a("div"),p=a("label"),E=c("GPU:"),T=M(),v=a("select"),N=a("option"),H=c("4"),R=a("option"),j=c("8"),D=a("option"),ae=c("16"),P=a("option"),q=c("24"),I=a("option"),le=c("32"),z=a("option"),J=c("64"),K=M(),W=a("div"),Z=a("label"),fe=c("Optimizer:"),me=M(),y=a("select"),$=a("option"),ge=c("AdamW8bit"),B=a("option"),Ee=c("Lion"),be=M(),b&&b.c(),ce=M(),ee=a("div"),G=a("ul"),Q=a("li"),Oe=c("Uses "),se=a("strong"),Le=c("1000 steps"),Ie=c(" as a baseline target."),Te=M(),X=a("li"),Ne=c("Limits training to "),oe=a("strong"),Pe=c("3500 steps"),Me=c(" to avoid overtraining."),Ae=M(),ne=a("li"),Re=c("Adjusts repeats, epochs, and batch size automatically."),ke=M(),re=a("li"),ze=c("Sets learning rates for UNet and text encoder based on steps."),this.h()},l(S){ft('[data-svelte="svelte-wgq0mm"]',document.head).forEach(t),r=A(S),o=l(S,"SECTION",{class:!0});var Ve=s(o);n=l(Ve,"DIV",{class:!0});var F=s(n);g=l(F,"H1",{});var we=s(g);k=_(we,"LoRA Training Settings Generator"),we.forEach(t),U=A(F),h=l(F,"FORM",{class:!0});var te=s(h);f=l(te,"DIV",{class:!0});var _e=s(f);O=l(_e,"LABEL",{for:!0,class:!0});var je=s(O);C=_(je,"Training Images:"),je.forEach(t),V=A(_e),m=l(_e,"INPUT",{type:!0,class:!0}),_e.forEach(t),L=A(te),u=l(te,"DIV",{class:!0});var he=s(u);p=l(he,"LABEL",{class:!0});var qe=s(p);E=_(qe,"GPU:"),qe.forEach(t),T=A(he),v=l(he,"SELECT",{class:!0});var Y=s(v);N=l(Y,"OPTION",{});var We=s(N);H=_(We,"4"),We.forEach(t),R=l(Y,"OPTION",{});var $e=s(R);j=_($e,"8"),$e.forEach(t),D=l(Y,"OPTION",{});var Be=s(D);ae=_(Be,"16"),Be.forEach(t),P=l(Y,"OPTION",{});var Fe=s(P);q=_(Fe,"24"),Fe.forEach(t),I=l(Y,"OPTION",{});var xe=s(I);le=_(xe,"32"),xe.forEach(t),z=l(Y,"OPTION",{});var He=s(z);J=_(He,"64"),He.forEach(t),Y.forEach(t),he.forEach(t),K=A(te),W=l(te,"DIV",{class:!0});var ue=s(W);Z=l(ue,"LABEL",{class:!0});var Je=s(Z);fe=_(Je,"Optimizer:"),Je.forEach(t),me=A(ue),y=l(ue,"SELECT",{class:!0});var Ge=s(y);$=l(Ge,"OPTION",{});var Ke=s($);ge=_(Ke,"AdamW8bit"),Ke.forEach(t),B=l(Ge,"OPTION",{});var Qe=s(B);Ee=_(Qe,"Lion"),Qe.forEach(t),Ge.forEach(t),ue.forEach(t),te.forEach(t),be=A(F),b&&b.l(F),ce=A(F),ee=l(F,"DIV",{class:!0});var Xe=s(ee);G=l(Xe,"UL",{});var x=s(G);Q=l(x,"LI",{});var ve=s(Q);Oe=_(ve,"Uses "),se=l(ve,"STRONG",{});var Ye=s(se);Le=_(Ye,"1000 steps"),Ye.forEach(t),Ie=_(ve," as a baseline target."),ve.forEach(t),Te=A(x),X=l(x,"LI",{});var de=s(X);Ne=_(de,"Limits training to "),oe=l(de,"STRONG",{});var Ze=s(oe);Pe=_(Ze,"3500 steps"),Ze.forEach(t),Me=_(de," to avoid overtraining."),de.forEach(t),Ae=A(x),ne=l(x,"LI",{});var et=s(ne);Re=_(et,"Adjusts repeats, epochs, and batch size automatically."),et.forEach(t),ke=A(x),re=l(x,"LI",{});var tt=s(re);ze=_(tt,"Sets learning rates for UNet and text encoder based on steps."),tt.forEach(t),x.forEach(t),Xe.forEach(t),F.forEach(t),Ve.forEach(t),this.h()},h(){document.title="LoRA Training Settings Generator",d(O,"for","totalImages"),d(O,"class","svelte-166haca"),d(m,"type","text"),m.required=!0,d(m,"class","svelte-166haca"),d(f,"class","form-group svelte-166haca"),d(p,"class","svelte-166haca"),N.__value="4",N.value=N.__value,R.__value="8",R.value=R.__value,D.__value="16",D.value=D.__value,P.__value="24",P.value=P.__value,I.__value="32",I.value=I.__value,z.__value="64",z.value=z.__value,d(v,"class","svelte-166haca"),i[1]===void 0&&ot(()=>i[7].call(v)),d(u,"class","form-group svelte-166haca"),d(Z,"class","svelte-166haca"),$.__value="AdamW8bit",$.value=$.__value,B.__value="Lion",B.value=B.__value,d(y,"class","optimizerInput svelte-166haca"),i[2]===void 0&&ot(()=>i[8].call(y)),d(W,"class","form-group svelte-166haca"),d(h,"class","form-flex svelte-166haca"),d(ee,"class","explanation svelte-166haca"),d(n,"class","content"),d(o,"class","background")},m(S,w){Ce(S,r,w),Ce(S,o,w),e(o,n),e(n,g),e(g,k),e(n,U),e(n,h),e(h,f),e(f,O),e(O,C),e(f,V),e(f,m),nt(m,i[0]),e(h,L),e(h,u),e(u,p),e(p,E),e(u,T),e(u,v),e(v,N),e(N,H),e(v,R),e(R,j),e(v,D),e(D,ae),e(v,P),e(P,q),e(v,I),e(I,le),e(v,z),e(z,J),pe(v,i[1]),e(h,K),e(h,W),e(W,Z),e(Z,fe),e(W,me),e(W,y),e(y,$),e($,ge),e(y,B),e(B,Ee),pe(y,i[2]),e(n,be),b&&b.m(n,null),e(n,ce),e(n,ee),e(ee,G),e(G,Q),e(Q,Oe),e(Q,se),e(se,Le),e(Q,Ie),e(G,Te),e(G,X),e(X,Ne),e(X,oe),e(oe,Pe),e(X,Me),e(G,Ae),e(G,ne),e(ne,Re),e(G,ke),e(G,re),e(re,ze),ye||(De=[ie(m,"input",i[6]),ie(v,"change",i[7]),ie(v,"change",i[5]),ie(y,"change",i[8]),ie(h,"input",i[5])],ye=!0)},p(S,[w]){w&1&&m.value!==S[0]&&nt(m,S[0]),w&2&&pe(v,S[1]),w&4&&pe(y,S[2]),w&16&&(Se=Object.keys(S[4]).length>0),Se?b?b.p(S,w):(b=ct(S),b.c(),b.m(n,ce)):b&&(b.d(1),b=null)},i:rt,o:rt,d(S){S&&t(r),S&&t(o),b&&b.d(),ye=!1,mt(De)}}}function bt(i,r,o){let n=250,g="4",k="AdamW8bit",U={},h={};function f(){const L={4:1,8:2,16:4,24:8,32:12,64:16}[g]||4;let u=Math.min(Math.max(Math.floor(200/n),4),10),p=n*u/L;const E=1e3;let T=Math.ceil(E/p);const v=20;for(;T>v&&u<10;)u++,p=n*u/L,T=Math.ceil(E/p);const N=Math.round(n*u*T/L);o(4,h={formula:`${n} images \xD7 ${u} repeats \xD7 ${T} epochs \xF7 ${L} batch = ${N} steps`,batchSize:L,trainRepeats:u,epochs:T});const R=Math.min(N,3500),j={network_dim:32,network_alpha:32,max_token_length:225,noise_offset:.1,lr_scheduler:"Constant",lr_scheduler_num_cycles:n<100?8:4},D=1e-4,ae=Math.sqrt(1e3/R);let P=Math.min(Math.max(D*ae,1e-4),.005),q=P*.1;q=Math.min(Math.max(q,1e-5),5e-5);const I=z=>{if(z===0)return"0";const J=Math.floor(Math.log10(z)),K=z/Math.pow(10,J);return K%1===0?`${K.toFixed(0)}e${J}`:`${K.toFixed(1)}e${J}`},le={AdamW8bit:{learning_rate:I(P),unet_lr:I(P),text_encoder_lr:I(q)},Lion:{learning_rate:I(P*.1),unet_lr:I(P*.1),text_encoder_lr:I(q*.1)}};o(3,U=Ue(Ue({},j),le[k]))}gt(()=>{f()});function O(){n=this.value,o(0,n)}function C(){g=it(this),o(1,g)}function V(){k=it(this),o(2,k)}return[n,g,k,U,h,f,O,C,V]}class Lt extends vt{constructor(r){super(),dt(this,r,bt,Et,pt,{})}}export{Lt as default};
